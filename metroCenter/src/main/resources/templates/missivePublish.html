<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title th:text="${title}"></title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/assets/css/dropzone.css" />


   <script th:replace="header :: header"></script>


    <!--[if lt IE 9]>
    <script src="/assets/js/html5shiv.js"></script>
    <script src="/assets/js/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="/css/myTableCSS/myTableCSS.css"/>
    <link rel="stylesheet" href="/css/myTableCSS/wlsh.defult.css" title="Default Styles" media="screen"/>

</head>

<body>
<script th:inline="javascript">

    // var userbase64 = /*"[[${userbase64}]]"*/ 'userbase64';
    /*<![CDATA[*/
    var instanceID = /*[[${instanceID}]]*/ 'instanceID';
    var currentEditableField=/*[[${currentEditableField}]]*/ null;
    var taskID = /*[[${taskID}]]*/ 'taskID';
    var taskName= /*[[${currentTaskName}]]*/ 'currentTaskName';
    var missiviPublishForm=/*[[${missivePublishForm}]]*/ 'instanceID';
    //     var obj=JSON.stringify(missiviPublishForm);
    var currentUser=/*[[${currentUser}]]*/ null;
    var currentUsername=/*[[${currentUser.userName}]]*/ null;
    //     var allUsers=/*[[${allUsers}]]*/ null;
    //     var alluserJSON=JSON.parse("("+allUsers+")");
    //     var alluserJSON=eval("("+allUsers+")");
    //     var allGroups=/*[[${allGroups}]]*/ null;
    var activitiNextStepInfo=/*[[${activitiNextStepInfo}]]*/ null;
    /*]]>*/

</script>
<div th:replace="navbar :: navbar(${user})"></div>


<div class="main-container" id="main-container">
<script type="text/javascript">
    try{ace.settings.check('main-container' , 'fixed')}catch(e){}
</script>

<div class="main-container-inner">
<a class="menu-toggler" id="menu-toggler" href="#">
    <span class="menu-text"></span>
</a>


<div th:replace="slider :: slidermenu(${'xjlc'})"></div>


<div class="main-content">
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
        </script>

        <ul class="breadcrumb">
            <li>
                <i class="icon-home home-icon"></i>
                <a href="/">主页</a>
            </li>
            <li class="active">
                <a href="#">发文</a>
            </li>
            <!--<li class="active">Blank Page</li>-->
        </ul><!-- .breadcrumb -->

        <div class="nav-search" id="nav-search">
            <form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="icon-search nav-search-icon"></i>
								</span>
            </form>
        </div><!-- #nav-search -->
    </div>

    <div class="page-content">
    <div class="widget-box" style="min-width: 1000px">
        <div class="widget-header widget-header-blue widget-header-flat">
            <h4 id="taskName_lable" class="lighter"></h4>
        </div>
        <div id="updateing_div" style="position:absolute;"> &nbsp;</div><!--进度条-->
        <div class="widget-body" style="min-width:891px;">
            <div class="widget-main">
                <form id="validatorForm" action="">
                <div class="row" style="width: 100%; display: inline-block">
                    <div id="validatorDIV" class="col-xs-12">
                        <div class="col-xs-6">
                            <div th:class="${#lists.contains(currentEditableField,'MissiveID')}?'':'hide'">
                                <label for="MissiveID" class="control-label bolder blue vali_lable">公文编号: &nbsp;&nbsp;</label>
                                <input id="MissiveID" name="MissiveID" class="vali_input" onchange="missiveNumChanged()" data-required-msg="请填写公文号"/>
                                <span class="k-invalid-msg" data-for="MissiveID"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'secretLevel')}?'':'hide'">
                                <label for="secretLevel" class="control-label bolder blue vali_lable">公文密级: &nbsp;&nbsp;</label>
                                <input id="secretLevel" class="vali_dropdown" name="secretLevel" data-required-msg="请选择密级">
                                <span class="k-invalid-msg" data-for="secretLevel"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'missiveType')}?'':'hide'">
                                <label for="missiveType" class="control-label bolder blue vali_lable">公文类型: &nbsp;&nbsp;</label>
                                <input id="missiveType" name="missiveType" class="vali_dropdown" data-required-msg="请选择公文类型"/>
                                <span class="k-invalid-msg" data-for="missiveType"></span>
                            </div>
                            <div style="display: flex">
                                <label id="signIssue_Person_Name" for="signIssue_Person" class="control-label bolder blue vali_lable">签发用户: &nbsp;&nbsp;</label>
                                <select th:Disabled="${#lists.contains(currentEditableField,'signIssue_Person')}?false:true" id="signIssue_Person" name="signIssue_Person" class="vali_select" data-required-msg="请选择签发用户"></select>
                                <span class="k-invalid-msg" data-for="signIssue_Person"></span>
                            </div>
                            <div style="display: flex">
                                <label id="counterSign_Person_Name" for="counterSign_Person" class="control-label bolder blue vali_lable">会签用户: &nbsp;&nbsp;</label>
                                <select th:Disabled="${#lists.contains(currentEditableField,'counterSign_Person')}?false:true" id="counterSign_Person" name="counterSign_Person" class="vali_select" data-required-msg="请选会签发用户"></select>
                                <span class="k-invalid-msg" data-for="counterSign_Person"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'mainSend_Person')}?'':'hide'" style="display: flex">
                                <label id="mainSend_Person_Name" for="mainSend_Person" class="control-label bolder blue vali_lable">主送部门: &nbsp;&nbsp;</label>
                                <select id="mainSend_Person" name="mainSend_Person" class="vali_select" data-required-msg="请选择主送部门"></select>
                                <span class="k-invalid-msg" data-for="mainSend_Person"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'copyTo_Person')}?'':'hide'" style="display: flex">
                                <label id="copyTo_Person_Name" for="copyTo_Person" class="control-label bolder blue vali_lable">抄送部门: &nbsp;&nbsp;</label>
                                <select id="copyTo_Person" name="copyTo_Person" class="vali_select" data-required-msg="请选择抄送部门"></select>
                                <span class="k-invalid-msg" data-for="copyTo_Person"></span>
                            </div>
                            <div  th:class="${#lists.contains(currentEditableField,'composeUser')}?'':'hide'" style="display: flex">
                                <label id="composeUser_Name" for="composeUser" class="control-label bolder blue vali_lable">排版用户: &nbsp;&nbsp;</label>
                                <select id="composeUser" name="composeUser" class="vali_select" data-required-msg="请选择排版用户"></select>
                                <span class="k-invalid-msg" data-for="composeUser"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'dep_LeaderCheck')}?'':'hide'" style="display: flex">
                                <label id="dep_LeaderCheck_Name" for="dep_LeaderCheck" class="control-label bolder blue vali_lable">处室领导: &nbsp;&nbsp;</label>
                                <select id="dep_LeaderCheck" name="dep_LeaderCheck" class="vali_select" data-required-msg="请选择处室领导核稿用户"></select>
                                <span class="k-invalid-msg" data-for="dep_LeaderCheck"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'officeCheck')}?'':'hide'" style="display: flex">
                                <label id="officeCheck_Name" for="officeCheck" class="control-label bolder blue vali_lable">办公室复核: &nbsp;&nbsp;</label>
                                <select id="officeCheck" name="officeCheck" class="vali_select" data-required-msg="请选择办公室审核用户"></select>
                                <span class="k-invalid-msg" data-for="officeCheck"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'printCount')}?'':'hide'" >
                                <label id="printCount_Name" for="printCount" class="control-label bolder blue vali_lable">打印份数: &nbsp;&nbsp;</label>
                                <input id="printCount" name="printCount" class="vali_dropdown" data-required-msg="请选择打印份数">
                                <span class="k-invalid-msg" data-for="printCount"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'CheckReader')}?'':'hide'" style="display: flex">
                                <label id="CheckReader_Name" class="control-label bolder blue vali_lable" for="CheckReader">校对用户: &nbsp;&nbsp;</label>
                                <select id="CheckReader" name="CheckReader" class="vali_select" data-required-msg="请选择校对用户"></select>
                                <span class="k-invalid-msg" data-for="CheckReader"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'Printer')}?'':'hide'" style="display: flex">
                                <label id="Printer_Name" class="control-label bolder blue vali_lable" for="Printer">打印用户: &nbsp;&nbsp;</label>
                                <select id="Printer" name="Printer" class="vali_select" data-required-msg="请选择打印用户"></select>
                                <span class="k-invalid-msg" data-for="Printer"></span>
                            </div>
                            <div id="GOVatrrDIV" th:class="${#lists.contains(currentEditableField,'initiativePublic')}?'':'hide'" style="padding-top: 5px">
                                <label class="control-label bolder blue">政府信息属性: &nbsp;&nbsp;</label><div></div>
                                <div class="radio" style="margin-top: 10px">
                                    <label>
                                        <input th:Disabled="${#lists.contains(currentEditableField,'initiativePublic')}?false:true" id="GOV1" name="GOV_attr" type="radio" class="ace" onclick="GovAttrClick()">
                                        <span class="lbl"> 主动公开</span>
                                    </label>
                                </div>

                                <div class="radio" style="margin-top: 10px">
                                    <label>
                                        <input th:Disabled="${#lists.contains(currentEditableField,'applyForPublic')}?false:true" id="GOV2" name="GOV_attr" type="radio" class="ace" onclick="GovAttrClick()">
                                        <span class="lbl"> 依申请公开</span>
                                    </label>
                                </div>
                                <div class="radio" style="margin-top: 10px">
                                    <label>
                                        <input th:Disabled="${#lists.contains(currentEditableField,'forbiddenPublic')}?false:true" id="GOV3" name="GOV_attr" type="radio" class="ace" onclick="GovAttrClick()">
                                        <span class="lbl"> 不予以公开</span>
                                    </label>
                                </div>
                                <span class="k-invalid-msg" data-for="GOV_attr"></span>
                            </div>
                        </div>
                        <div class="col-xs-6">
                            <div th:class="${#lists.contains(currentEditableField,'missiveTittle')}?'':'hide'">
                                <label class="control-label bolder blue" for="mainSend">主送外单位: &nbsp;&nbsp;</label><br/>
                                <textarea th:Disabled="${#lists.contains(currentEditableField,'missiveTittle')}?false:true"
                                          id="mainSend" class="vali_textarea" name="mainSend" onchange="mainSendChange()" style="height: 80px;width: 400px;"
                                          data-required-msg=""></textarea>
                                <span class="k-invalid-msg" data-for="mainSend"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'missiveTittle')}?'':'hide'">
                                <label class="control-label bolder blue" for="copyTo">抄送外单位: &nbsp;&nbsp;</label><br/>
                                <textarea th:Disabled="${#lists.contains(currentEditableField,'missiveTittle')}?false:true"
                                          id="copyTo" class="vali_textarea" name="copyTo" onchange="copyToChange()" style="height: 80px;width: 400px;"
                                          data-required-msg=""></textarea>
                                <span class="k-invalid-msg" data-for="missiveTittle"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'missiveTittle')}?'':'hide'">
                                <label class="control-label bolder blue" for="missiveTittle">标题: &nbsp;&nbsp;</label><br/>
                                <textarea th:Disabled="${#lists.contains(currentEditableField,'missiveTittle')}?false:true"
                                          id="missiveTittle" class="vali_textarea" name="missiveTittle" onchange="missiveTittletextChange()" style="height: 80px;width: 400px;"
                                          data-required-msg="标题不能为空">
                                </textarea>
                                <span class="k-invalid-msg" data-for="missiveTittle"></span>
                            </div>
                            <div th:class="${#lists.contains(currentEditableField,'appendTittle')}?'':'hide'">
                                <label class="control-label bolder blue" for="appendTittle">附件标题: &nbsp;&nbsp;</label><br/>
                                <textarea th:Disabled="${#lists.contains(currentEditableField,'appendTittle')}?false:true"
                                          id="appendTittle" class="vali_textarea" name="appendTittle" onchange="appendTittletextChange()" style="height: 80px;width: 400px;"
                                          data-required-msg="附件标题不能为空">
                                </textarea>
                            </div>
                            <span class="k-invalid-msg" data-for="appendTittle"></span>
                        </div>
                        <!--<div id="activitiOptionDiv" th:class="${!#lists.contains(currentEditableField,'missiveTittle')}?'col-xs-12':'hide'">-->
                        <div id="activitiOptionDiv" class="hide">
                            <div class="hr hr-double hr-dotted hr18"></div>
                            <div id="activitiOption" class="control-group">
                                <label id="activitiOption_lable" class="control-label bolder blue" style="width: 300px;text-align: left;"></label><div></div>

                            </div>

                        </div>
                        <div class="col-xs-12" style="margin-top: 5px">
                            <div >
                                <a th:href=@{/historyProcess/{instanceID}(instanceID=${instanceID})} class="btn btn-sm bigger btn-success" ><i class="icon-check"></i>任务信息</a>
                            </div>
                        </div>
                    </div>
                </div>
                </form>
            </div>
        </div>
    </div>


        <div class="row">

            <div class="col-xs-12">

            <!-- PAGE CONTENT BEGINS -->
                <div id="missiveForm" style="width:891px;height:1260px;background-image: url('/img/MissivePublish.png');background-size:contain;background-repeat:no-repeat">
                    <!--<div id="missiveBackGFromPAD" style="width:891px;height:1260px;-->
                                        <!--background-size:contain;background-repeat:no-repeat;position: absolute">-->
                    <!--</div>-->
                    <img th:src=@{/api/bgPng/missivePublish/{instanceID}(instanceID=${instanceID})}
                         th:if="${hasBgPng}"
                         style="float:left;position:absolute;top:0px;left:0px"/>
                    <div id="signatureDiv" class="" style="top: -20px;left: -50px;height:1px;width:1px;position: absolute;"></div>
                    <div style="height: 40px;width: 70px;top: 112px;position: absolute;left: 186px;text-align: center;">
                        <label id="MissiveID_lable" ></label>
                    </div>
                    <div style="height: 40px;width: 100px;top: 113px;left: 480px;position: absolute;">
                        <label id="secretLevel_lable"></label>
                    </div>
                    <div style="height: 40px;width: 100px;top: 112px;left: 720px;position: absolute;">
                        <label id="missiveType_lable"></label>
                    </div>
                    <!--签发place-->
                    <div style="height: 40px;width: 410px;top: 160px;left: 115px;position: absolute;">
                        <!--<select th:data-placeholder="${#lists.contains(currentEditableField,'signIssue_Person')}?'123':'234'" th:Disabled="${#lists.contains(currentEditableField,'signIssue_Person')}?false:true" id="signIssue_Person" style="width: 330px;"></select>-->
                    </div>
                    <div style="height: 189px;width: 410px;top: 192px;left: 45px;position: absolute;">
                        <img id="signIssue_img" style="width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none"/>
                    </div>
                    <div style="height: 189px;width: 410px;top: 192px;left: 45px;position: absolute;">
                        <label id="signIssueBase30img" hidden="hidden"/>
                    </div>
                    <div style="height: 189px;width: 410px;top: 192px;left: 45px;background:none;position: absolute;">
                        <textarea th:Disabled="${#lists.contains(currentEditableField,'signIssue_Content')}?false:true"
                                  id="signIssue_Content" style="width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none"></textarea>

                    </div>
                    <div th:if="${#lists.contains(currentEditableField, 'signIssue_SignBtn')}"  style="height: 20px;width: 20px;top: 164px;left: 120px;position: absolute;">
                        <button  id="signIssue_SignBtn" class="btn btn-xs btn-primary"
                                 onclick="signaturePlace('signatureDiv',820,378,'signIssue_img',410,189,'signIssueBase30img',signIssue_Base30,'signIssue_Content')">
                            <i class="icon-edit bigger-110"></i>
                            手写
                        </button>
                    </div>




                    <!--会签place-->
                    <div style="height: 40px;width: 410px;top: 160px;left: 520px;position: absolute;">
                        <!--<select th:Disabled="${#lists.contains(currentEditableField,'counterSign_Person')}?false:true" id="counterSign_Person" style="width: 330px;"></select>-->
                    </div>
                   <!--<div th:if="${!#lists.contains(currentEditableField, 'counterSign_Person')}" style="height: 40px;width: 410px;top: 160px;left: 520px;position: absolute;">-->
                       <!--<select  id="counterSign_Person" style="width: 330px;" disabled="disabled"></select>-->
                    <!--</div>-->
                    <div  style="height: 189px;width: 410px;top: 192px;left: 460px;position: absolute;">
                        <label id="counterSignBase30img" hidden/>
                    </div>
                    <div  style="height: 189px;width: 410px;top: 192px;left: 460px;;position: absolute;">
                        <img id="counterSign_img" style="width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none"/>
                    </div>
                    <div style="height: 189px;width: 410px;top: 192px;left: 460px;background:none;position: absolute;">
                        <textarea th:Disabled="${#lists.contains(currentEditableField,'counterSign_Content')}?false:true" id="counterSign_Content" style="width: 100%;height: 100%;position: absolute;margin:0px;padding:0px;background: none"></textarea>
                    </div>
                    <div th:if="${#lists.contains(currentEditableField, 'counterSign_SignBtn')}"  style="height: 20px;width: 20px;top: 164px;left: 528px;position: absolute;">
                        <button  id="counterSign_SignBtn" class="btn btn-xs btn-primary"
                                onclick="signaturePlace('signatureDiv',820,378,'counterSign_img',410,189,'counterSignBase30img',counterSign_Base30,'counterSign_Content')">
                            <i class="icon-edit bigger-110"></i>
                            手写
                        </button>
                    </div>

                    <!--主送place-->
                    <div style="height: 40px;width: 410px;top: 386px;left: 115px;position: absolute;">
                        <!--<select th:Disabled="${#lists.contains(currentEditableField,'mainSend_Person')}?false:true" id="mainSend_Person" style="width: 330px;"></select>-->
                    </div>
                    <div style="top: 450px;left: 80px;position: absolute;">
                        <label id="mainSend_Person_lable" style="word-wrap: break-word;width: 355px;"></label>
                    </div>
                    <!--郑小罗 2014/12/25 添加接收主送外单位label-->
                    <div style="top: 500px;left: 80px;position: absolute;">
                        <label id="mainSend_lable" style="word-wrap: break-word;width: 355px;"></label>
                    </div>
                    <div style="height: 40px;width: 410px;top: 386px;left: 520px;position: absolute;">
                        <!--<select th:Disabled="${#lists.contains(currentEditableField,'copyTo_Person')}?false:true" id="copyTo_Person" style="width: 330px;"></select>-->
                    </div>
                    <div style="top: 450px;left: 490px;position: absolute;">
                        <label id="copyTo_Person_lable" style="word-wrap: break-word;width: 355px;"></label>
                    </div>
                    <!--郑小罗 2014/12/25 添加接收抄送外单位label-->
                    <div style="top: 500px;left: 490px;position: absolute;">
                        <label id="copyTo_lable" style="word-wrap: break-word;width: 355px;"></label>
                    </div>
                    <!---->
                    <div style="height: 35px;width: 280px;top: 618px;left: 160px;position: absolute;">
                        <label id="sponsorUnit" style="width: 280px;"></label>
                    </div>
                    <div style="height: 35px;width: 280px;top: 665px;left: 145px;position: absolute;">
                        <label id="drafter" style="width: 280px;/* border: solid */"></label>
                    </div>
                    <div style="height: 35px;width: 280px;top: 715px;left: 125px;position: absolute;">
                        <label id="phoneNum" style="width: 280px;"></label>
                    </div>
                    <div style="height: 35px;width: 280px;top: 760px;left: 125px;position: absolute;">
                        <label id="composeUser_lable" style="width: 280px;"></label>
                    </div>

                    <div style="height: 35px;width: 250px;top: 618px;left: 608px;position: absolute;">
                        <label id="dep_LeaderCheck_lable" style="width: 250px; "></label>
                    </div>
                    <div style="height: 35px;width: 270px;top: 665px;left: 585px;position: absolute;">
                        <label id="officeCheck_lable" style="width: 270px;"></label>
                    </div>
                    <div style="height: 35px;width: 80px;top: 712px;left: 570px;position: absolute;">
                        <!--<input th:Disabled="${#lists.contains(currentEditableField,'printCount')}?false:true" id="printCount" style="width: 80px;">-->
                        <label id="printCount_lable" style="width: 270px;"></label>
                    </div>
                    <div style="height: 35px;width: 270px;top: 760px;left: 530px;position: absolute;">
                        <label id="CheckReader_lable" style="width: 280px;"></label>
                    </div>


                    <!--公开属性-->
                    <div style="height: 22px;width: 22px;top: 813px;left: 225px;position: absolute;z-index: 1">
                        <label>
                            <input id="initiativePublic" name="form-field-checkbox" type="checkbox" class="ace ace-checkbox-2"
                                   onclick="checkboxChange('initiativePublic','applyForPublic','forbiddenPublic')"/>
                            <span class="lbl" style="width: 105px;height:25px"></span>
                        </label>
                    </div>
                    <div style="height: 22px;width: 22px;top: 813px;left: 468px;position: absolute;z-index:1">
                        <label>
                            <input id="applyForPublic" name="form-field-checkbox" type="checkbox" class="ace ace-checkbox-2"
                                   onclick="checkboxChange('applyForPublic','initiativePublic','forbiddenPublic')"/>
                            <span class="lbl" style="width: 125px;height:25px"></span>
                        </label>
                    </div>
                    <div style="height: 22px;width: 22px;top: 862px;left: 225px;position: absolute;z-index:1">
                        <label>
                            <input id="forbiddenPublic" name="form-field-checkbox" type="checkbox" class="ace ace-checkbox-2"
                                   onclick="checkboxChange('forbiddenPublic','applyForPublic','initiativePublic')"/>
                            <span class="lbl" style="width: 105px;height:25px"></span>
                        </label>
                    </div>
                    <div style="height: 135px;width: 620px;top: 798px;left: 218px;position: absolute;z-index:3">

                    </div>
                    <!--标题-->
                    <div style="height: 113px;width: 770px;top: 980px;left: 95px;position: absolute;">
                        <pre style="background: none;border: none">
                        <label id="missiveTittle_lable" style="word-wrap: break-word;width: 740px;"></label>
                        </pre>
                        <!--<textarea th:Disabled="${#lists.contains(currentEditableField,'missiveTittle')}?false:true" id="missiveTittle" style="width: 100%;height: 100%;position: absolute;;"></textarea>-->
                    </div>
                    <!--附件标题-->
                    <div style="height: 75px;width: 770px;top: 1130px;left: 95px;position: absolute;">
                        <pre style="background: none;border: none">
                        <label id="appendTittle_lable" style="word-wrap: break-word;width: 740px;"></label>
                        </pre>
                    </div>
                </div>
                <!--发文稿纸-->

                <table width="891px">
                    <!--Un-->
                    <tr class="trClass borderNone">
                        <td class="borderNone"  style="width: 16.66%;height: 0px"></td>
                        <td class="borderNone"  style="width: 16.66%;height: 0px"></td>
                        <td class="borderNone"  style="width: 16.66%;height: 0px"></td>
                        <td class="borderNone"  style="width: 16.66%;height: 0px"></td>
                        <td class="borderNone"  style="width: 16.66%;height: 0px"></td>
                        <td class="borderNone"  style="width: 16.66%;height: 0px"></td>
                    </tr>
                    <tr th:class="${#lists.contains(currentEditableField,'attachments')}?'trClass borderNone':'hide'">
                        <td class="borderNone" colspan="6">
                            <div class="hr hr-double hr-dotted hr18"></div>
                            <h3 class="header smaller lighter header-color-red">
                                <i class="icon-cloud-upload"></i>
                                上传附件
                            </h3>
                        </td>

                    </tr>
                    <tr th:class="${#lists.contains(currentEditableField,'attachments')}?'trClass borderNone':'hide'">
                        <td class="borderNone" colspan="6">

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="demo-section k-header" id="filesDIV">
                                        <input type="file" name="files" id="attachments" />
                                    </div>
                                </div><!-- /.col -->
                            </div><!-- /.row -->

                        </td>

                    </tr>
                    <tr class="trClass borderNone">
                        <td class="borderNone" colspan="6">

                            <div class="widget-box transparent">
                                <div class="widget-header widget-header-small">
                                    <h4 class="blue smaller">
                                        <i class="icon-list orange"></i>
                                        附件
                                    </h4>

                                    <div class="widget-toolbar action-buttons">
                                        <a href="#" data-action="collapse">
                                            <i class="icon-chevron-up"></i>
                                        </a>
                                    </div>
                                </div>

                                <div class="widget-body">
                                    <div class="widget-main padding-8" id="fileList">
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr class="trClass borderNone">
                        <td class="tdClass borderNone" colspan="6">
                            <div class="clearfix form-actions" style="min-width : 768px">
                                <div class="col-xs-1 col-xs-offset-4 col-sm-offset-4 col-sm-1 col-md-offset-4 col-md-1 ">
                                    <button id="submitAll" class="btn btn-info" type="submit" form="submitForm" onclick="submitAllClick()">
                                        <i class="icon-ok bigger-110"></i>
                                        提交
                                    </button>
                                </div>

                                <div class="col-xs-2 col-xs-offset-1 col-sm-offset-1 col-sm-2 col-md-offset-1 col-md-2 ">
                                    <button class="btn btn-danger" data-action="close" onclick="cancelSubmit()">
                                        <i class="icon-remove bigger-110"></i>
                                        取消
                                    </button>
                                </div>
                                <script>
                                    function cancelSubmit(){
                                        if(confirm("确认取消？"))
                                        {
                                            window.location.href='/dbzx';
                                            window.event.returnValue = false;
                                        }
                                    }
                                </script>
                            </div>
                        </td>
                    </tr>
                    <tr class="trClass borderNone" hidden>
                        <td class="tdClass borderNone" colspan="6">
                            <div class="clearfix form-actions" style="min-width : 768px" hidden>
                                <form id="submitForm" action="/missive/setMissivePublish" method="POST">
                                    <input id="UserNameF" name="UserName"/>
                                    <input id="instanceIDF" name="instanceID"/>
                                    <input id="taskIDF" name="taskID"/>
                                    <input id="missiveNumF" name="missiveNum"/>
                                    <input id="secretLevelF" name="secretLevel"/>
                                    <input id="typeNameF" name="typeName"/>
                                    <input id="docFilePathF" name="docFilePath"/>
                                    <input id="pdfFilePathF" name="pdfFilePath"/>
                                    <input id="missiveTittleF" name="missiveTittle"/>
                                    <input id="nameF" name="name"/>

                                    <input id="signIssueUserNameF" name="signIssueUserName"/>
                                    <input id="signIssueBase30urlF" name="signIssueBase30url"/>
                                    <input id="signIssueImageurlF" name="signIssueImageurl"/>
                                    <input id="signIssue_ContentF" name="signIssue_Content"/>

                                    <input id="counterSignUsersNameF" name="counterSignUsersName"/>
                                    <input id="counterSignBase30urlF" name="counterSignBase30url"/>
                                    <input id="counterSignImageurlF" name="counterSignImageurl"/>
                                    <input id="counterSign_ContentF" name="counterSign_Content"/>

                                    <input id="mainSendGroupsF" name="mainSendGroups"/>
                                    <input id="copytoGroupsF" name="copytoGroups"/>

                                    <input id="sponsorUnitF" name="sponsorUnit"/>
                                    <input id="drafterF" name="drafter"/>
                                    <input id="phoneNumF" name="phoneNum"/>
                                    <input id="composeUserF" name="composeUser"/>
                                    <input id="dep_LeaderCheckF" name="dep_LeaderCheck"/>
                                    <input id="officeCheckF" name="officeCheck"/>
                                    <input id="printCountF" name="printCount"/>
                                    <input id="CheckReaderF" name="CheckReader"/>
                                    <input id="PrinterF" name="Printer"/>
                                    <input id="Gov_info_attrF" name="Gov_info_attr"/>
                                    <input id="appendTittleF" name="appendTittle"/>
                                    <input id="appendNameF" name="appendName"/>
                                    <input id="appendPathF" name="appendPath"/>
                                    <input id="activitiVariablesF" name="activitiVariables"/>
                                    <!--郑小罗 2014/12/25 添加主送、抄送外单位-->
                                    <input id="mainSendF" name="mainSend"/>
                                    <input id="copyToF" name="copyTo"/>

                                </form>
                            </div>
                        </td>
                    </tr>

                </table>
                <!-- PAGE CONTENT ENDS -->
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.page-content -->
</div><!-- /.main-content -->

<!---->
</div><!-- /.main-container-inner -->

<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
    <i class="icon-double-angle-up icon-only bigger-110"></i>
</a>
</div><!-- /.main-container -->
<script src="/js/elementUseage.js"></script>
<!-- basic scripts -->

<!--[if !IE]> -->

<script src='/assets/js/jquery-2.0.3.min.js'></script>

<!-- <![endif]-->

<!--[if IE]>

<![endif]-->

<!--[if !IE]> -->

<script type="text/javascript">
    window.jQuery || document.write("<script src='/assets/js/jquery-2.0.3.min.js'>"+"<"+"script>");
</script>

<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"script>");
</script>
<![endif]-->

<script type="text/javascript">
    if("ontouchend" in document) document.write("<script src='/assets/js/jquery.mobile.custom.min.js'>"+"<"+"script>");
</script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/typeahead-bs2.min.js"></script>

<!-- page specific plugin scripts -->

<!--[if lte IE 8]>
<script src="/assets/js/excanvas.min.js"></script>
<![endif]-->

<script src="/assets/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="/assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="/assets/js/jquery.slimscroll.min.js"></script>
<script src="/assets/js/jquery.easy-pie-chart.min.js"></script>
<script src="/assets/js/jquery.sparkline.min.js"></script>
<script src="/assets/js/flot/jquery.flot.min.js"></script>
<script src="/assets/js/flot/jquery.flot.pie.min.js"></script>
<script src="/assets/js/flot/jquery.flot.resize.min.js"></script>
<script src="/assets/js/dropzone.min.js"></script>
<!--<script src="js/jSingnature/libs/jSignature.min.noconflict.js"></script>-->
<!--<script src="js/jSingnature/libs/modernizr.js"></script>-->
<script src="/js/jSingnature/src/jSignature.js"/>



<!--[if lt IE 9]>
<script type="text/javascript" src="/js/jSingnature/libs/flashcanvas.js"></script>
<![endif]-->


<!-- ace scripts -->

<script src="/assets/js/ace-elements.min.js"></script>
<script src="/assets/js/ace.min.js"></script>

<!-- inline scripts related to this page -->


<script src="/js/console.js"></script>
<script src="/js/kendo.web.min.js"></script>
<script src="/js/jSingnature/jSignature.wlsh.js" type="text/javascript" defer></script>
<script src="/js/jSingnature/src/plugins/jSignature.CompressorBase30.js" type="text/javascript"></script>
<script src="/js/jquery.cookie.js"></script>
<script src="/js/fileList.wls.js" type="text/javascript"/>
<script id="fileTemplate" type="text/x-kendo-template">
    <span class='k-progress'></span>
    <div class='file-wrapper'>
        <span class='file-icon #=addExtensionClass(files[0].extension)#'></span>
        <h4 class='file-heading file-name-heading'>Name: #=name#</h4>
        <h4 class='file-heading file-size-heading'>Size: #=size# bytes</h4>
        <button type='button' class='k-upload-action'></button>
    </div>
</script>
<script type="text/javascript">
    function signaturePlace(divName,width,height,imgDivName,imgWidth,imgHeight,imgUrlForSave,signBase30Url_Previous,textareaID){
        /*
         divName:需要弹出并用来签名的div名称
         width：需要进行签名div的width
         height：需要进行签名div的height
         imgDivName：导出生成图片的div名称
         imgID:生成图片的ID
         imgWidth：导出生成图片的div的width
         imgHeight：导出生成图片的div的height
         imgUrlForSave:用来保存signature的base30格式的lable的ID
         signBase30Url_Previous:前一个签字的base30编码
         signBase30Url_Editer:本次签字的base30编码
         textareaID */
        var signBase30Url_Editer;

        try{
            signBase30Url_Editer=$("#"+imgUrlForSave)[0].value;
        }
        catch(error){
            console.log(error);
        }
        openSignatureWindow(divName,width,height,imgDivName,imgWidth,imgHeight,imgUrlForSave,signBase30Url_Editer,signBase30Url_Previous,textareaID);
    }
    function checkboxChange(checkbox1,checkbox2,checkbox3){


        if($("#"+checkbox1)[0].checked){

            $("#"+checkbox2)[0].checked=false;
            $("#"+checkbox3)[0].checked=false;
        }
    }
    function Changecheckbox(checkbox1,checkbox2,checkbox3){


        $("#"+checkbox1)[0].checked=true;
        $("#"+checkbox2)[0].checked=false;
        $("#"+checkbox3)[0].checked=false;

    }
    function GovAttrClick(){
        if($("#GOV1")[0].checked){
            Changecheckbox('initiativePublic','applyForPublic','forbiddenPublic');
        }
        else if($("#GOV2")[0].checked){
            Changecheckbox('applyForPublic','initiativePublic','forbiddenPublic');
        }
        else if($("#GOV3")[0].checked){
            Changecheckbox('forbiddenPublic','initiativePublic','applyForPublic');
        }
    }
    function missiveNumChanged(){
        $("#MissiveID_lable")[0].innerHTML= $("#MissiveID")[0].value;//
    }
    function missiveTittletextChange(){
        $("#missiveTittle_lable")[0].innerHTML=  $("#missiveTittle")[0].value;
    }
    function appendTittletextChange(){
        $("#appendTittle_lable")[0].innerHTML=  $("#appendTittle")[0].value;
    }
    //2014/12/25 郑小罗 添加主送外部门
    function mainSendChange(){
        $("#mainSend_lable")[0].innerText=$("#mainSend")[0].value;
    }
    function copyToChange(){
        $("#copyTo_lable")[0].innerText=$("#copyTo")[0].value;
    }



    var resultFiles=[];//存放结果文件集合
    var initFiles = [];
    var version=0;
    if(missiviPublishForm.missiveInfo!=null){
        if(missiviPublishForm.missiveInfo.versions[0]!=null){
            if(missiviPublishForm.missiveInfo.versions[0].versionNumber!=0)
                version=missiviPublishForm.missiveInfo.versions[0].versionNumber;
        }
    }
    var filePath_version=1;
    if(version==0)
        filePath_version=version+1;
    else
        filePath_version=version;
    $(function($) {
        <!--上传文件相关js代码-->
//        var attachmentkendoUpload = $("#attachments").data("kendoUpload").options.files;

        if(missiviPublishForm.missiveInfo!=null){
            if(missiviPublishForm.missiveInfo.versions[0]!=null){
                if(missiviPublishForm.missiveInfo.versions[0].attachments.length!=0){
                    for(var i=0;i<missiviPublishForm.missiveInfo.versions[0].attachments.length;i++){
                        var temp={};
                        temp.extension="."+missiviPublishForm.missiveInfo.versions[0].attachments[i].attachmentTittle.split('.')[missiviPublishForm.missiveInfo.versions[0].attachments[i].attachmentTittle.split('.').length-1];//后缀
                        temp.name=missiviPublishForm.missiveInfo.versions[0].attachments[i].attachmentTittle;
                        temp.size=1;
                        initFiles.push(temp);
                        //-------add list of attachments--->>>>>
                        fileListCreate("fileList",temp,"attachments","filesDIV",currentEditableField);

                    }
                }
            }
        }
        resultFiles=initFiles;//将初始化的文件数字赋值给结果数据，然后将上传文件加入文件数组
        $("#attachments").kendoUpload({
            multiple: true,
            async: {
                saveUrl: '/missivePublish/upload/'+instanceID,
                autoUpload: false
            },
            localization: {
                select: "选择文件....",
                uploadSelectedFiles:"上传"
            },
            select: onSelect,
            success: onSuccess,
            files: initFiles
        });
         //set init_files visible be false;
        for(var initfiles_i=0;initfiles_i<initFiles.length;initfiles_i++){
            var hide_init_file=$("span[class='k-filename'][title='"+initFiles[initfiles_i].name+"']");
            for(var hide_init_file_i=0;hide_init_file_i<hide_init_file.length;hide_init_file_i++){
                $(hide_init_file[hide_init_file_i]).parent()[0].setAttribute("class","hide");
            }
        }
    });
    //选择文件时触发事件
    function onSelect(e) {
    }

    //上传文件成功时触发事件
    function onSuccess(e) {
        // Array with information about the uploaded files
        var files = e.files;
        //将上传的文件写入到resultFiles数组中

        if(e.operation=="upload"){
            if (e.response == true) {
                addObjFromObj(e);//添加文件信息到文件数组
            }
        }else{
            if (e.response == true) {
                //初始文件对象中删除指定对象
                delObjFromObj(e);
            }
        }

        filePath_version=version+1;

        $("#fileList").empty();
        for(var i=0;i<resultFiles.length;i++){
            var temp=resultFiles[i];
            //-------add list of attachments--->>>>>
            fileListCreate("fileList",temp,"attachments","filesDIV",currentEditableField);
        }

    }
    //初始文件对象中增加上传文件对象
    function addObjFromObj(e){
        var files= e.files[0];

        var fileName = e.files[0].name;
        resultFiles=resultFiles.filter(function(el){
            return el.name!==fileName;
        });

        var temp={};
        temp.name= files.name;//文件名
        temp.extension=files.extension;//后缀名
        resultFiles.push(temp);
        var hide_span_file=$("span[class='k-filename'][title='"+e.files[0].name+"']");
        for(var span_file_i=0;span_file_i<hide_span_file.length;span_file_i++){
            $(hide_span_file[span_file_i]).parent()[0].setAttribute("class","hide");
        }
    }
    function fileListCreate(fileListDiv_id,file,attachment_id,attachmentparent_id,editableElementList){
        //fileListDiv_id--文件列表的id
        //file：文件{name;extension;size}
        //attachment_id:附件控件的id   //其必须有父级元素
        //attachmentparent_id:父级元素
        //editableElementList：当前可编辑控件集合的数组
        //pdfViewerURL:pdf浏览器URL
        //fileURL：文件下载的URL
        //fileUploadUrl  文件上传的URL//'/missivePublish/upload/'+instanceID,
        //fileRemoveURL;文件删除的URL// "/missivePublish/remove/"+instanceID;
        var pdfViewerURL="/pdfViewer/web/viewer.html?file=";
        var fileURL="/pdf/missivePublish/"+instanceID+"/"+filePath_version+"/"+file.name;
        var fileRemoveURL = "/missivePublish/remove/"+instanceID;
        var fileUploadUrl="/missivePublish/upload/"+instanceID;
        createFileListElement(fileListDiv_id,file,attachment_id,attachmentparent_id,editableElementList,pdfViewerURL,fileURL,fileUploadUrl,fileRemoveURL);
    }


</script>


<script type="text/javascript">
//-------------------------变量定义-----------------------------------\
    var blankBase30url="data:image/jsignature;base30,";
    var blankImageurl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAxEAAAFjCAYAAABCEoaFAAAWB0lEQVR4Xu3XoREAAAgDMbr/0szwPuiqHOZ3jgABAgQIECBAgAABAkFgYWtKgAABAgQIECBAgACBExGegAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSQgIhKXMQECBAgQIECAAAECIsIPECBAgAABAgQIECCQBERE4jImQIAAAQIECBAgQEBE+AECBAgQIECAAAECBJKAiEhcxgQIECBAgAABAgQIiAg/QIAAAQIECBAgQIBAEhARicuYAAECBAgQIECAAAER4QcIECBAgAABAgQIEEgCIiJxGRMgQIAAAQIECBAgICL8AAECBAgQIECAAAECSUBEJC5jAgQIECBAgAABAgREhB8gQIAAAQIECBAgQCAJiIjEZUyAAAECBAgQIECAgIjwAwQIECBAgAABAgQIJAERkbiMCRAgQIAAAQIECBAQEX6AAAECBAgQIECAAIEkICISlzEBAgQIECBAgAABAiLCDxAgQIAAAQIECBAgkAREROIyJkCAAAECBAgQIEBARPgBAgQIECBAgAABAgSSgIhIXMYECBAgQIAAAQIECIgIP0CAAAECBAgQIECAQBIQEYnLmAABAgQIECBAgAABEeEHCBAgQIAAAQIECBBIAiIicRkTIECAAAECBAgQICAi/AABAgQIECBAgAABAklARCQuYwIECBAgQIAAAQIERIQfIECAAAECBAgQIEAgCYiIxGVMgAABAgQIECBAgICI8AMECBAgQIAAAQIECCQBEZG4jAkQIECAAAECBAgQEBF+gAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSQgIhKXMQECBAgQIECAAAECIsIPECBAgAABAgQIECCQBERE4jImQIAAAQIECBAgQEBE+AECBAgQIECAAAECBJKAiEhcxgQIECBAgAABAgQIiAg/QIAAAQIECBAgQIBAEhARicuYAAECBAgQIECAAAER4QcIECBAgAABAgQIEEgCIiJxGRMgQIAAAQIECBAgICL8AAECBAgQIECAAAECSUBEJC5jAgQIECBAgAABAgREhB8gQIAAAQIECBAgQCAJiIjEZUyAAAECBAgQIECAgIjwAwQIECBAgAABAgQIJAERkbiMCRAgQIAAAQIECBAQEX6AAAECBAgQIECAAIEkICISlzEBAgQIECBAgAABAiLCDxAgQIAAAQIECBAgkAREROIyJkCAAAECBAgQIEBARPgBAgQIECBAgAABAgSSgIhIXMYECBAgQIAAAQIECIgIP0CAAAECBAgQIECAQBIQEYnLmAABAgQIECBAgAABEeEHCBAgQIAAAQIECBBIAiIicRkTIECAAAECBAgQICAi/AABAgQIECBAgAABAklARCQuYwIECBAgQIAAAQIERIQfIECAAAECBAgQIEAgCYiIxGVMgAABAgQIECBAgICI8AMECBAgQIAAAQIECCQBEZG4jAkQIECAAAECBAgQEBF+gAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSQgIhKXMQECBAgQIECAAAECIsIPECBAgAABAgQIECCQBERE4jImQIAAAQIECBAgQEBE+AECBAgQIECAAAECBJKAiEhcxgQIECBAgAABAgQIiAg/QIAAAQIECBAgQIBAEhARicuYAAECBAgQIECAAAER4QcIECBAgAABAgQIEEgCIiJxGRMgQIAAAQIECBAgICL8AAECBAgQIECAAAECSUBEJC5jAgQIECBAgAABAgREhB8gQIAAAQIECBAgQCAJiIjEZUyAAAECBAgQIECAgIjwAwQIECBAgAABAgQIJAERkbiMCRAgQIAAAQIECBAQEX6AAAECBAgQIECAAIEkICISlzEBAgQIECBAgAABAiLCDxAgQIAAAQIECBAgkAREROIyJkCAAAECBAgQIEBARPgBAgQIECBAgAABAgSSgIhIXMYECBAgQIAAAQIECIgIP0CAAAECBAgQIECAQBIQEYnLmAABAgQIECBAgAABEeEHCBAgQIAAAQIECBBIAiIicRkTIECAAAECBAgQICAi/AABAgQIECBAgAABAklARCQuYwIECBAgQIAAAQIERIQfIECAAAECBAgQIEAgCYiIxGVMgAABAgQIECBAgICI8AMECBAgQIAAAQIECCQBEZG4jAkQIECAAAECBAgQEBF+gAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSQgIhKXMQECBAgQIECAAAECIsIPECBAgAABAgQIECCQBERE4jImQIAAAQIECBAgQEBE+AECBAgQIECAAAECBJKAiEhcxgQIECBAgAABAgQIiAg/QIAAAQIECBAgQIBAEhARicuYAAECBAgQIECAAAER4QcIECBAgAABAgQIEEgCIiJxGRMgQIAAAQIECBAgICL8AAECBAgQIECAAAECSUBEJC5jAgQIECBAgAABAgREhB8gQIAAAQIECBAgQCAJiIjEZUyAAAECBAgQIECAgIjwAwQIECBAgAABAgQIJAERkbiMCRAgQIAAAQIECBAQEX6AAAECBAgQIECAAIEkICISlzEBAgQIECBAgAABAiLCDxAgQIAAAQIECBAgkAREROIyJkCAAAECBAgQIEBARPgBAgQIECBAgAABAgSSgIhIXMYECBAgQIAAAQIECIgIP0CAAAECBAgQIECAQBIQEYnLmAABAgQIECBAgAABEeEHCBAgQIAAAQIECBBIAiIicRkTIECAAAECBAgQICAi/AABAgQIECBAgAABAklARCQuYwIECBAgQIAAAQIERIQfIECAAAECBAgQIEAgCYiIxGVMgAABAgQIECBAgICI8AMECBAgQIAAAQIECCQBEZG4jAkQIECAAAECBAgQEBF+gAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSQgIhKXMQECBAgQIECAAAECIsIPECBAgAABAgQIECCQBERE4jImQIAAAQIECBAgQEBE+AECBAgQIECAAAECBJKAiEhcxgQIECBAgAABAgQIiAg/QIAAAQIECBAgQIBAEhARicuYAAECBAgQIECAAAER4QcIECBAgAABAgQIEEgCIiJxGRMgQIAAAQIECBAgICL8AAECBAgQIECAAAECSUBEJC5jAgQIECBAgAABAgREhB8gQIAAAQIECBAgQCAJiIjEZUyAAAECBAgQIECAgIjwAwQIECBAgAABAgQIJAERkbiMCRAgQIAAAQIECBAQEX6AAAECBAgQIECAAIEkICISlzEBAgQIECBAgAABAiLCDxAgQIAAAQIECBAgkAREROIyJkCAAAECBAgQIEBARPgBAgQIECBAgAABAgSSgIhIXMYECBAgQIAAAQIECIgIP0CAAAECBAgQIECAQBIQEYnLmAABAgQIECBAgAABEeEHCBAgQIAAAQIECBBIAiIicRkTIECAAAECBAgQICAi/AABAgQIECBAgAABAklARCQuYwIECBAgQIAAAQIERIQfIECAAAECBAgQIEAgCYiIxGVMgAABAgQIECBAgICI8AMECBAgQIAAAQIECCQBEZG4jAkQIECAAAECBAgQEBF+gAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSQgIhKXMQECBAgQIECAAAECIsIPECBAgAABAgQIECCQBERE4jImQIAAAQIECBAgQEBE+AECBAgQIECAAAECBJKAiEhcxgQIECBAgAABAgQIiAg/QIAAAQIECBAgQIBAEhARicuYAAECBAgQIECAAAER4QcIECBAgAABAgQIEEgCIiJxGRMgQIAAAQIECBAgICL8AAECBAgQIECAAAECSUBEJC5jAgQIECBAgAABAgREhB8gQIAAAQIECBAgQCAJiIjEZUyAAAECBAgQIECAgIjwAwQIECBAgAABAgQIJAERkbiMCRAgQIAAAQIECBAQEX6AAAECBAgQIECAAIEkICISlzEBAgQIECBAgAABAiLCDxAgQIAAAQIECBAgkAREROIyJkCAAAECBAgQIEBARPgBAgQIECBAgAABAgSSgIhIXMYECBAgQIAAAQIECIgIP0CAAAECBAgQIECAQBIQEYnLmAABAgQIECBAgAABEeEHCBAgQIAAAQIECBBIAiIicRkTIECAAAECBAgQICAi/AABAgQIECBAgAABAklARCQuYwIECBAgQIAAAQIERIQfIECAAAECBAgQIEAgCYiIxGVMgAABAgQIECBAgICI8AMECBAgQIAAAQIECCQBEZG4jAkQIECAAAECBAgQEBF+gAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSQgIhKXMQECBAgQIECAAAECIsIPECBAgAABAgQIECCQBERE4jImQIAAAQIECBAgQEBE+AECBAgQIECAAAECBJKAiEhcxgQIECBAgAABAgQIiAg/QIAAAQIECBAgQIBAEhARicuYAAECBAgQIECAAAER4QcIECBAgAABAgQIEEgCIiJxGRMgQIAAAQIECBAgICL8AAECBAgQIECAAAECSUBEJC5jAgQIECBAgAABAgREhB8gQIAAAQIECBAgQCAJiIjEZUyAAAECBAgQIECAgIjwAwQIECBAgAABAgQIJAERkbiMCRAgQIAAAQIECBAQEX6AAAECBAgQIECAAIEkICISlzEBAgQIECBAgAABAiLCDxAgQIAAAQIECBAgkAREROIyJkCAAAECBAgQIEBARPgBAgQIECBAgAABAgSSgIhIXMYECBAgQIAAAQIECIgIP0CAAAECBAgQIECAQBIQEYnLmAABAgQIECBAgAABEeEHCBAgQIAAAQIECBBIAiIicRkTIECAAAECBAgQICAi/AABAgQIECBAgAABAklARCQuYwIECBAgQIAAAQIERIQfIECAAAECBAgQIEAgCYiIxGVMgAABAgQIECBAgICI8AMECBAgQIAAAQIECCQBEZG4jAkQIECAAAECBAgQEBF+gAABAgQIECBAgACBJCAiEpcxAQIECBAgQIAAAQIiwg8QIECAAAECBAgQIJAERETiMiZAgAABAgQIECBAQET4AQIECBAgQIAAAQIEkoCISFzGBAgQIECAAAECBAiICD9AgAABAgQIECBAgEASEBGJy5gAAQIECBAgQIAAARHhBwgQIECAAAECBAgQSAIiInEZEyBAgAABAgQIECAgIvwAAQIECBAgQIAAAQJJQEQkLmMCBAgQIECAAAECBESEHyBAgAABAgQIECBAIAmIiMRlTIAAAQIECBAgQICAiPADBAgQIECAAAECBAgkARGRuIwJECBAgAABAgQIEBARfoAAAQIECBAgQIAAgSTwRdcBZA2nfHIAAAAASUVORK5CYII=";//上一个流程的会签签字状态

    var MissiveID=null;//收文号

    var secretLevel;//密级
    var secretLevel_lable=null;
    var missiveType;//公文类型
    var missiveType_lable=null;

    var signIssue_Person=null;//签发人员
    var signIssue_img=blankImageurl;//签发内容图片
    var signIssue_Content=null;//签发内容textArea
    var signIssue_Base30=blankBase30url;//签发内容图片
    var counterSign_Person=[];//会签人员
    var counterSign_img=blankImageurl;//会签内容图片
    var counterSign_Base30=blankBase30url;//会签内容图片
    var counterSign_Content=null;//会签内容textArea


    var mainSend_Person=[];//主送人员
    var mansendGroups_lable=null;
    var copyTo_Person=[];//抄送人员
    var copytoGroups_lable=null;

    //郑小罗 2014/12/25 添加主送、抄送外单位
    var mainSend="";//主送外单位
    var copyTo="";//抄送外单位

    var sponsorUnit=null;//主办单位
    var drafter=null;//拟稿人
    var drafterUserName=null;
    var phoneNum=null;//电话

    var composeUser=null;//排版
    var composeUserlable=null;
    var dep_LeaderCheck=null;//处室领导核稿
    var dep_LeaderChecklable=null;
    var officeCheck=null;//办公室复核
    var officeChecklable=null;
    var printCount=0;//打印份数
    var CheckReader=null;//校对人
    var CheckReaderlable=null;

    var GovInfoAttr;//公开xinxi

    var missiveTittle=null;//标题
    var appendTittle=null;//附件标题
//    var BackImageURLFromPAD=null;//BackImageFromPAD

//    var PostServerURL="http://localhost:8080/activiti-rest/service/runtime/tasks/"+taskID;
    var userbase64="Basic c3FoZTE4OjE5ODMxMDI4";
    var variables=[];


    $(function($) {// //----------------------页面初始化--------------------------------------

        if(currentEditableField.length>0){
            // the list of elements need validate
            for(var validator_i=0;validator_i<currentEditableField.length;validator_i++){
                try{
                    $("#"+currentEditableField[validator_i])[0].setAttribute("required",true);
                }
                catch (e){}

            }
            // the list of elements need not validate
            var unrequired=["#counterSign_Person","#mainSend_Person","#copyTo_Person","#appendTittle"]
            for(var unrequired_i=0;unrequired_i<unrequired.length;unrequired_i++){
                try{
                    $(unrequired[unrequired_i])[0].removeAttribute("required");
                }
                catch (e){}
            }
        }
        var userdataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    herders:{
                        "Authorization": $.cookie("userbase64")
                     },
                    url: "/api/user/getalluser",
                    dataType: "json"
                }
            }
        });
        var signIssueuserdataSource=userdataSource;
        var officeUserdataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    herders:{
                        "Authorization": $.cookie("userbase64")
                    },
                    url: "/api/user/getuserbygroupname/办公室",
                    dataType: "json"
                }
            }
        });
        var groupDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    herders:{
                        "Authorization": $.cookie("userbase64")
                    },
                    url: "/api/group/getallgroup",
                    dataType: "json"
                }
            }
        });
        var missiveTypeDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    herders:{
                        "Authorization": $.cookie("userbase64")
                    },
                    url: "/api/missive/missivetype/getmissivetype",
                    dataType: "json"
                }
            }
        });
        var secretLevelDataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    herders:{
                        "Authorization": $.cookie("userbase64")
                    },
                    url: "/api/missive/secretlevel/getsecretlevel",
                    dataType: "json"
                }
            }
        });
        $("#missiveType").kendoDropDownList({
//            valuePrimitive: true,
            dataTextField: "typeName",
            dataValueField: "id",
//            value:3,
            dataSource: missiveTypeDataSource,
            change: function(e){
                $("#missiveType_lable")[0].innerText=this.text();
            }

        });

        $("#secretLevel").kendoDropDownList({

            dataTextField: "secretLevelName",
            dataValueField: "id",
            dataSource: secretLevelDataSource,
            change: function(e) {
                $("#secretLevel_lable")[0].innerText = this.text();
            }
        });
        $("#signIssue_Person").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "未选择签发用户...",
            dataTextField: "name",
            dataValueField: "userName",
//            autoBind: false,
            maxSelectedItems:1,
            dataSource: userdataSource,
            tagTemplate:'#: name #',
            itemTemplate:'#: name # -- #: group.groupName #',

            value: [
//                { ProductName: "Chang", ProductID: 2 },
//                { ProductName: "Uncle Bob's Organic Dried Pears", ProductID: 7 }
            ]
        });

        $("#counterSign_Person").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "未选择会签用户...",
            dataTextField: "name",
            dataValueField: "userName",
//            autoBind: false,
            dataSource: userdataSource,
            tagTemplate:'#: name #',
            itemTemplate:'#: name # -- #: group.groupName #'
        });
        $("#mainSend_Person").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "未选择主送部门...",
            dataTextField: "groupName",
            dataValueField: "id",
//            autoBind: false,
//            maxSelectedItems:1,
            dataSource:groupDataSource,
            tagTemplate:'#: groupName #',
            change:function(e) {
                  try {
                      var mainsendgroups = null;
                      for (var i = 0; i < this.dataItems().length; i++) {
                          if (i == 0) {
                              mainsendgroups = this.dataItems()[i].groupName;
                          }
                          else mainsendgroups = mainsendgroups + ", " + this.dataItems()[i].groupName;
                      }

                      $("#mainSend_Person_lable")[0].innerText = mainsendgroups;
                  }
                catch (ex){}
            }
        });
        $("#copyTo_Person").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "未选择抄送部门...",
            dataTextField: "groupName",
            dataValueField: "id",
//            autoBind: false,
            //maxSelectedItems:1,
            dataSource: groupDataSource,
            tagTemplate:'#: groupName #',
            change:function(e) {
                try {
                    var copytogroups = null;
                    for (var i = 0; i < this.dataItems().length; i++) {
                        if (i == 0) {
                            copytogroups = this.dataItems()[i].groupName;
                        }
                        else copytogroups = copytogroups + ", " + this.dataItems()[i].groupName;
                    }
                    $("#copyTo_Person_lable")[0].innerText = copytogroups;
                }
                catch (ex){}
            }
        });
        $("#composeUser").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "未选择排版用户...",
            dataTextField: "name",
            dataValueField: "userName",
//            autoBind: false,
            maxSelectedItems:1,
            dataSource: userdataSource,
            tagTemplate:'#: name #',
            itemTemplate:'#: name # -- #: group.groupName #',
            change:function(e) {
                try {
                    var username = null;
                    for (var i = 0; i < this.dataItems().length; i++) {
                        if (i == 0) {
                            username = this.dataItems()[i].name;
                        }
                        else username = username + ", " + this.dataItems()[i].name;
                    }
                    $("#composeUser_lable")[0].innerText = username;
                }
                catch (ex){}
            }

        });
        $("#dep_LeaderCheck").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "请选择核稿用户...",
            dataTextField: "name",
            dataValueField: "userName",
//            autoBind: false,
            maxSelectedItems:1,
            dataSource: userdataSource,
            tagTemplate:'#: name #',
            itemTemplate:'#: name # -- #: group.groupName #',
            change:function(e) {
                try {
                    var username = null;
                    for (var i = 0; i < this.dataItems().length; i++) {
                        if (i == 0) {
                            username = this.dataItems()[i].name;
                        }
                        else username = username + ", " + this.dataItems()[i].name;
                    }
                    $("#dep_LeaderCheck_lable")[0].innerText = username;
                }
                catch (ex){}
            }

        });
        $("#officeCheck").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "请选择办公室用户...",
            dataTextField: "name",
            dataValueField: "userName",
//            autoBind: false,
            maxSelectedItems:1,
            dataSource: officeUserdataSource,
            tagTemplate:'#: name #',
            itemTemplate:'#: name # -- #: group.groupName #',
            change:function(e) {
                try {
                    var username = null;
                    for (var i = 0; i < this.dataItems().length; i++) {
                        if (i == 0) {
                            username = this.dataItems()[i].name;
                        }
                        else username = username + ", " + this.dataItems()[i].name;
                    }
                    $("#officeCheck_lable")[0].innerText = username;
                }
                catch (ex){}
            }

        });
        $("#printCount").kendoNumericTextBox({
            decimals: 0,
            format: "n0",
            value:0,
            min: 0,
            change: function() {
                var value = this.value();
                $("#printCount_lable")[0].innerText = value;
            }

        });
        $("#CheckReader").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "请选择校对用户...",
            dataTextField: "name",
            dataValueField: "userName",
//            autoBind: false,
            maxSelectedItems:1,
            dataSource: userdataSource,
            tagTemplate:'#: name #',
            itemTemplate:'#: name # -- #: group.groupName #',
            change:function(e) {
                try {
                    var username = null;
                    for (var i = 0; i < this.dataItems().length; i++) {
                        if (i == 0) {
                            username = this.dataItems()[i].name;
                        }
                        else username = username + ", " + this.dataItems()[i].name;
                    }
                    $("#CheckReader_lable")[0].innerText = username;
                }
                catch (ex){}
            }

        });
        $("#Printer").kendoMultiSelect({
            theme: "[bootstrap]",
            placeholder: "请选择打印用户...",
            dataTextField: "name",
            dataValueField: "userName",
//            autoBind: false,
            maxSelectedItems:1,
            dataSource: userdataSource,
            tagTemplate:'#: name #',
            itemTemplate:'#: name # -- #: group.groupName #'

        });
        $("#taskName_lable")[0].innerText=taskName;
        $("#activitiOption_lable")[0].innerText=taskName+"处理(必选)";
        textAreaUsable("signIssue_Content",currentEditableField);
        textAreaUsable("counterSign_Content",currentEditableField);
        function textAreaUsable(elementname,ListContainer){
            try{

                if($.inArray(elementname, ListContainer) > -1){

                    $("#"+elementname)[0] .style.border="solid";
                    $("#"+elementname)[0] .style.borderWidth="1px";
                    $("#"+elementname)[0] .style.borderColor="#428bca";
//                    $("#"+elementname)[0].placeholder="请输入内容..."
                }
                else {
                    $("#"+elementname)[0] .style.border="none";
                    $("#"+elementname)[0] .placeholder=""  ;
                }
            }
            catch (e){console.log(e)}
        }
        //设置upload可用性
        var uploadattachments = $("#attachments").data("kendoUpload");
        if($.inArray("attachments", currentEditableField) > -1){
//            uploadattachments.disable();
        }
        else{
            uploadattachments.disable();
        }
        // enables the upload
        try{
            var spanLength=$("span[class='hide']").parent().length;
            for(var spani=0;spani<spanLength;spani++){
                try{
                    $("span[class='hide']").parent()[0].setAttribute("class","hide");
                }
                catch (e){}
            }
        }
        catch (e){}

//=========================================================================
        if(missiviPublishForm.missiveInfo!=null){
            if(missiviPublishForm.missiveInfo.missiveNum!=0){
                MissiveID=missiviPublishForm.missiveInfo.missiveNum;
            }
            if(missiviPublishForm.missiveInfo.secretLevel!=null){
                secretLevel=missiviPublishForm.missiveInfo.secretLevel.id;
                secretLevel_lable=missiviPublishForm.missiveInfo.secretLevel.secretLevelName;
            }
            if(missiviPublishForm.missiveInfo.missiveType!=null){
                missiveType=missiviPublishForm.missiveInfo.missiveType.id;
                missiveType_lable=missiviPublishForm.missiveInfo.missiveType.typeName;
            }

        }
        if(missiviPublishForm.signIssueUser!=null){//签发人员
            signIssue_Person=missiviPublishForm.signIssueUser.userName;
        }
        if(missiviPublishForm.signIssueContent!=null){//
            signIssue_img=missiviPublishForm.signIssueContent.imageurl;//签发内容图片
            signIssue_Base30=missiviPublishForm.signIssueContent.base30url;
            signIssue_Content=missiviPublishForm.signIssueContent.contentText.replace(/<br>/g,"\n");//签发内容textArea
        }
        if(missiviPublishForm.counterSignUsers!=null){//会签人员
            try{
                for(var i=0;i<missiviPublishForm.counterSignUsers.length;i++){
                    counterSign_Person.push(missiviPublishForm.counterSignUsers[i].userName);
                }
            }
            catch (e){
                try{
                    counterSign_Person.push(missiviPublishForm.counterSignUsers.userName);
                }
                catch (e){
                    console.log(e)
                }
            }

        }//会签内容end
        if(missiviPublishForm.counterSignContent!=null){//
            counterSign_img=missiviPublishForm.counterSignContent.imageurl;//会签内容图片
            counterSign_Base30=missiviPublishForm.counterSignContent.base30url;
            counterSign_Content=missiviPublishForm.counterSignContent.contentText.replace(/<br>/g,"\n");;//会签内容textArea
        }

        //====主送and抄送
        if(missiviPublishForm.mainSendGroups!=null){//主送人员
            try{
                for(var i=0;i<missiviPublishForm.mainSendGroups.length;i++){
                    mainSend_Person.push(missiviPublishForm.mainSendGroups[i].id);
                    if(i==0) mansendGroups_lable = missiviPublishForm.mainSendGroups[i].groupName;
                    else{
                        mansendGroups_lable = mansendGroups_lable+", "+missiviPublishForm.mainSendGroups[i].groupName;
                    }
                }
            }
            catch (e){
                try{
                    mainSend_Person.push(missiviPublishForm.mainSendGroups.id);
                    mansendGroups_lable = missiviPublishForm.mainSendGroups.groupName;
                }
                catch (e){
                    console.log(e)
                }
            }

        }//主送内容end
        if(missiviPublishForm.copytoGroups!=null){//chao送人员
            try{
                for(var i=0;i<missiviPublishForm.copytoGroups.length;i++){
                    copyTo_Person.push(missiviPublishForm.copytoGroups[i].id);
                    if(i==0)copytoGroups_lable= missiviPublishForm.copytoGroups[i].groupName;
                    else{
                        copytoGroups_lable = copytoGroups_lable+", "+missiviPublishForm.copytoGroups[i].groupName;
                    }
                }
            }
            catch (e){
                try{
                    copyTo_Person.push(missiviPublishForm.copytoGroups.id);
                    copytoGroups_lable= missiviPublishForm.copytoGroups.groupName;
                }
                catch (e){
                    console.log(e)
                }
            }

        }//chao送内容end

        //郑小罗 2014/12/25 添加主送、抄送外单位
        mainSend=missiviPublishForm.mainSend;
        copyTo=missiviPublishForm.copyTo;

        //根据当前登录用户获取电话，单位，拟稿人的信息 start
        if(missiviPublishForm.drafterUser==null){
            if(currentUser.group!=null&&currentUser.group.groupName!=null)
            sponsorUnit=currentUser.group.groupName;//主办单位
            drafter=currentUser.name;//拟稿人
            drafterUserName=currentUser.userName;
            phoneNum=currentUser.tel;//电话
        }
        else{
            if(missiviPublishForm.drafterUser!=null){
                if(missiviPublishForm.drafterUser.group!=null)
                sponsorUnit=missiviPublishForm.drafterUser.group.groupName;
                drafter=missiviPublishForm.drafterUser.name;
                drafterUserName=missiviPublishForm.drafterUser.userName;
                phoneNum=missiviPublishForm.drafterUser.tel;
            }
        }
        //排版人..=
        if(missiviPublishForm.composeUser!=null){
            composeUser=missiviPublishForm.composeUser.userName;
            composeUserlable=missiviPublishForm.composeUser.name;
        }
        if(missiviPublishForm.dep_LeaderCheckUser!=null){
            dep_LeaderCheck=missiviPublishForm.dep_LeaderCheckUser.userName;//部门领导
            dep_LeaderChecklable=missiviPublishForm.dep_LeaderCheckUser.name;
        }
        if(missiviPublishForm.officeCheckUser!=null){
            officeCheck=missiviPublishForm.officeCheckUser.userName;//办公室复核
            officeChecklable=missiviPublishForm.officeCheckUser.name;
        }
        if(missiviPublishForm.printCount!=0){
            printCount=missiviPublishForm.printCount;//打印份数
        }
        if(missiviPublishForm.checkReader!=null){
            CheckReader=missiviPublishForm.checkReader.userName;//校对
            CheckReaderlable=missiviPublishForm.checkReader.name;//校对
        }
        if(missiviPublishForm.gov_info_attr!=0){
            GovInfoAttr=missiviPublishForm.gov_info_attr;//公开属性
        }
        if(missiviPublishForm.missiveTittle!=null){
            missiveTittle=missiviPublishForm.missiveTittle.replace(/<br>/g,"\n");//公开属性
        }
        if(missiviPublishForm.attachmentTittle!=null){
            appendTittle=missiviPublishForm.attachmentTittle.replace(/<br>/g,"\n");//公开属性
        }
//        if(missiviPublishForm.backgroudImage!=null){
//            BackImageURLFromPAD=missiviPublishForm.backgroudImage;//BackImageFromPAD
//        }
        //missiveBackGFromPAD
        //-----------------------------数据绑定------------------------------>
        $("#MissiveID")[0].value=MissiveID;//

        $("#MissiveID_lable")[0].innerHTML=MissiveID;//
        var dropdownlistsecretLevel = $("#secretLevel").data("kendoDropDownList");
        dropdownlistsecretLevel.value(secretLevel);
        $("#secretLevel_lable")[0].innerText = secretLevel_lable;
//

        var dropdownlistmissiveType = $("#missiveType").data("kendoDropDownList");
        dropdownlistmissiveType.value(missiveType);
        $("#missiveType_lable")[0].innerText = missiveType_lable;


        var multiselectsignIssue_Person = $("#signIssue_Person").data("kendoMultiSelect");
        multiselectsignIssue_Person.value([signIssue_Person]);
        $("#signIssue_img")[0].src=signIssue_img;//签发图片
        $("#signIssueBase30img")[0].value=signIssue_Base30;//签发base30图片
        $("#signIssue_Content")[0].value=signIssue_Content;//签发content


        var multiselectcounterSign_Person = $("#counterSign_Person").data("kendoMultiSelect");
        multiselectcounterSign_Person.value(counterSign_Person);
        $("#counterSign_img")[0].src=counterSign_img;//会签图片
        $("#counterSignBase30img")[0].value=counterSign_Base30;//
        $("#counterSign_Content")[0].value=counterSign_Content;//


        var multiselectmainSend_Person = $("#mainSend_Person").data("kendoMultiSelect");
        multiselectmainSend_Person.value(mainSend_Person);
        $("#mainSend_Person_lable")[0].innerText = mansendGroups_lable;
        var multiselectcopyTo_Person = $("#copyTo_Person").data("kendoMultiSelect");
        multiselectcopyTo_Person.value(copyTo_Person);
        $("#copyTo_Person_lable")[0].innerText = copytoGroups_lable;

        //郑小罗 2012/12/25 添加主送、抄送外单位
        $("#mainSend_lable")[0].innerText=mainSend;
        $("#copyTo_lable")[0].innerText=copyTo;
        //获取电话，单位，拟稿人的信息 start

        $("#sponsorUnit")[0].innerText=sponsorUnit;
        $("#drafter")[0].innerText=drafter;
        $("#phoneNum")[0].innerText=phoneNum;

        var multiselectcomposeUser = $("#composeUser").data("kendoMultiSelect");//排版
        multiselectcomposeUser.value([composeUser]);
        $("#composeUser_lable")[0].innerText = composeUserlable;


        var multiselectdep_LeaderCheck = $("#dep_LeaderCheck").data("kendoMultiSelect");//部门领导
        multiselectdep_LeaderCheck.value([dep_LeaderCheck]);
        $("#dep_LeaderCheck_lable")[0].innerText = dep_LeaderChecklable;


        var multiselectofficeCheck = $("#officeCheck").data("kendoMultiSelect");//办公室复核
        multiselectofficeCheck.value([officeCheck]);
        $("#officeCheck_lable")[0].innerText = officeChecklable;

        var printCountNumericTextBox=$("#printCount").data("kendoNumericTextBox");//打印份数
        printCountNumericTextBox.value(printCount);
        $("#printCount_lable")[0].innerText = printCount;


        var multiselectCheckReader = $("#CheckReader").data("kendoMultiSelect");//校对
        multiselectCheckReader.value([CheckReader]);
        $("#CheckReader_lable")[0].innerText = CheckReaderlable;

        if(GovInfoAttr==1){//-----------------------//政府公开属性
            $("#initiativePublic")[0].checked=true;
            $("#GOV1")[0].checked=true;
        }
        else if(GovInfoAttr==2){
            $("#applyForPublic")[0].checked=true;
            $("#GOV2")[0].checked=true;
        }
        else if(GovInfoAttr==3){
            $("#forbiddenPublic")[0].checked=true;
            $("#GOV3")[0].checked=true;
        }

        $("#missiveTittle")[0].value=missiveTittle;//标题
        $("#missiveTittle_lable")[0].innerText = missiveTittle;

        $("#appendTittle")[0].value=appendTittle;//附件标题
        $("#appendTittle_lable")[0].innerText=appendTittle;
//        if(BackImageURLFromPAD!=null)
//        $("#missiveBackGFromPAD")[0].style.backgroundImage="url("+BackImageURLFromPAD+")";
            //=========================================================

    });

    if(activitiNextStepInfo!=null){
        for(var i=0;i<activitiNextStepInfo.length;i++){
            if(activitiNextStepInfo[i].condition!=""){
                $("#activitiOptionDiv")[0].className="col-xs-12";
                var div1=document.createElement("div");
                $(div1)[0].style.marginLeft="20px";
                $(div1)[0].style.marginTop="10px";
                var lable1=document.createElement("lable");
                var input1=document.createElement("input");
                input1.className+="ace";
                $(input1)[0].setAttribute("name","radiogroup2");
                $(input1)[0].setAttribute("type","radio");
                $(input1)[0].setAttribute("required",true);
                $(input1)[0].data = i;
                input1.onclick = function (e) {
                    // if the condition is "IsBack", Remove all elements' validator which has been seted
                    if(activitiNextStepInfo[e.target.data].condition=="Back"){
                        if(currentEditableField.length>0){
                            for(var validator_i=0;validator_i<currentEditableField.length;validator_i++){
                                try{
                                    $("#"+currentEditableField[validator_i])[0].removeAttribute("required");
                                }
                                catch (e){}
                            }
                        }
                    }
                    else{
                        if(currentEditableField.length>0){
                            for(var validator_i=0;validator_i<currentEditableField.length;validator_i++){
                                try{
                                    $("#"+currentEditableField[validator_i])[0].setAttribute("required",true);
                                }
                                catch (e){}
                            }
                            // the list of elements need not validate
                            var unrequired=["#counterSign_Person","#mainSend_Person","#copyTo_Person","#appendTittle"]
                            for(var unrequired_i=0;unrequired_i<unrequired.length;unrequired_i++){
                                try{
                                    $(unrequired[unrequired_i])[0].removeAttribute("required");
                                }
                                catch (e){}
                            }
                        }
                    }


                    variables.splice(0,variables.length);
                    var variable_json={};
                    $(variable_json).attr("name", "IsPass");
                    $(variable_json).attr("value", activitiNextStepInfo[e.target.data].condition);
                    $(variable_json).attr("type", "string");
                    $(variable_json).attr("multi", "false");
                    variables.push(variable_json);

                    if(activitiNextStepInfo[e.target.data].multi==true){
                        var AssigneeUsers="";
                        try{
                            var KendoUsers=$("#"+activitiNextStepInfo[e.target.data].multiAssignee).data("kendoMultiSelect").value();
                            if(KendoUsers.length!=0){
                                for(var v=0;v<KendoUsers.length;v++){
                                    if(v==0){
                                        AssigneeUsers=KendoUsers[v];
                                    }
                                    else{
                                        AssigneeUsers=AssigneeUsers+";"+KendoUsers[v];
                                    }

                                }
                            }
                            else{
                                alert("请指定"+$("#"+activitiNextStepInfo[e.target.data].multiAssignee+"_Name")[0].innerText);
                                e.target.checked=false;
                            }
                        }
                        catch (e){
//                            alert("未选择相关用户！")
                        }
                        var variable_json1={};
                        $(variable_json1).attr("name", activitiNextStepInfo[e.target.data].multiAssignee);
                        $(variable_json1).attr("value", AssigneeUsers);
                        $(variable_json1).attr("type", "string");
                        $(variable_json1).attr("multi", activitiNextStepInfo[e.target.data].multi);
                        variables.push(variable_json1);
                    }
                    else{
                        var AssigneeUsers="";
                        if(activitiNextStepInfo[e.target.data].assignee=="drafterUser"){
                            AssigneeUsers=missiviPublishForm.drafterUser.userName;
                        }
                        else{
                            try{
                                var KendoUsers=$("#"+activitiNextStepInfo[e.target.data].assignee).data("kendoMultiSelect").value();
//                                AssigneeUsers=KendoUsers[0];
                                if(KendoUsers.length!=0){
                                    AssigneeUsers=KendoUsers[0];
                                }
                                else{
                                    alert("请指定"+$("#"+activitiNextStepInfo[e.target.data].assignee+"_Name")[0].innerText);
//                                    console.log(e);
                                    e.target.checked=false;
                                }
                            }
                            catch (ex){
                                alert("未选择相关用户！")
                            }
                        }
                        var variable_json1={};
                        $(variable_json1).attr("name", activitiNextStepInfo[e.target.data].assignee);
                        $(variable_json1).attr("value",AssigneeUsers);
                        $(variable_json1).attr("type", "string");
                        $(variable_json1).attr("multi", activitiNextStepInfo[e.target.data].multi);
                        variables.push(variable_json1);
                    }
                }
                $(input1).appendTo($(lable1));
                var span1=document.createElement("span");
                span1.className+="lbl";
                $(span1)[0].style.fontSize="14px";
                $(span1)[0].style.fontWeight="bold";
                $(span1)[0].innerText="  "+activitiNextStepInfo[i].name;
                $(span1).appendTo($(lable1));
                $(lable1).appendTo($(div1));
                $(div1).appendTo($("#activitiOption"));
            }
        }
    }



    $("#submitForm").submit(function(e) {
        var validator = $("#validatorDIV").kendoValidator().data("kendoValidator");
        var validatorForm=$("#validatorForm")[0];
        if (validator.validate()&&validatorForm.checkValidity()) {
            if(activitiNextStepInfo!=null){
                for(var i=0;i<activitiNextStepInfo.length;i++){
                    if(activitiNextStepInfo[i].condition=="") {
                        variables.splice(0,variables.length);
                        if(activitiNextStepInfo[0].multi==true){
                            var AssigneeUsers="";
                            try{
                                var KendoUsers=$("#"+activitiNextStepInfo[0].multiAssignee).data("kendoMultiSelect").value();
                                if(KendoUsers.length!=0){
                                    for(var v=0;v<KendoUsers.length;v++){
                                        if(v==0){
                                            AssigneeUsers=KendoUsers[v];
                                        }
                                        else{
                                            AssigneeUsers=AssigneeUsers+";"+KendoUsers[v];
                                        }
                                    }
                                }
                                else{
                                    alert("未指定"+$("#"+activitiNextStepInfo[0].multiAssignee+"_Name")[0].innerText);
                                    e.preventDefault();
                                }

                            }
                            catch (e){
//                                alert("未选择相关用户！")
                            }
                            var variable_json={};
                            $(variable_json).attr("name", activitiNextStepInfo[0].multiAssignee);
                            $(variable_json).attr("value", AssigneeUsers);
                            $(variable_json).attr("type", "string");
                            $(variable_json).attr("multi", activitiNextStepInfo[0].multi);
                            variables.push(variable_json);
                        }
                        else{
                            var AssigneeUsers="";
                            if(activitiNextStepInfo[0].assignee=="drafterUser"){
                                AssigneeUsers=missiviPublishForm.drafterUser.userName;
                            }
                            else{
                                try{
                                    var KendoUsers=$("#"+activitiNextStepInfo[0].assignee).data("kendoMultiSelect").value();
                                    if(KendoUsers.length!=0){
                                        AssigneeUsers=KendoUsers[0];
                                    }
                                    else{
                                        alert("未指定"+$("#"+activitiNextStepInfo[0].assignee+"_Name")[0].innerText);
                                        e.preventDefault();
                                    }
                                }
                                catch (e){
//                                    alert("未选择相关用户！");
                                }
                            }
                            var variable_json={};
                            $(variable_json).attr("name", activitiNextStepInfo[0].assignee);
                            $(variable_json).attr("value", AssigneeUsers);
                            $(variable_json).attr("type", "string");
                            $(variable_json).attr("multi", activitiNextStepInfo[0].multi);
                            variables.push(variable_json);
                        }
                    }
                }
            }
            var variablesString="";
            for(var j=0;j<variables.length;j++){
                if(j==0){
                    variablesString+=(variables[j].name+","+variables[j].value+","+variables[j].type+","+variables[j].multi);
                }
                else{
                    variablesString+=("|"+variables[j].name+","+variables[j].value+","+variables[j].type+","+variables[j].multi);
                }

            }
            $("#activitiVariablesF").val(variablesString);
            console.log("数据提交成功!");
            var detail_window_template='<div><div class="progress progress-striped active"><div class="progress-bar progress-bar-purple" style="width: 100%;"></div></div><div style="text-align: center"><h6>数据正在提交...</h6></div></div>';
            var windowsdiv2 = document.createElement("div");
            $(windowsdiv2).appendTo($("#updateing_div"));
            var window_height=$(window).height();
            var window_width=$(window).width();
//        alert($(window).height()); //浏览器当前窗口可视区域高度
//        alert($(document).height()); //浏览器当前窗口文档的高度
//        alert($(document.body).height());//浏览器当前窗口文档body的高度
            $('#updateing_div').css('top', $(document).scrollTop()+$(window).height()/2-60);
            $(windowsdiv2).kendoWindow({
//                actions: ["Close"],
                title: false,
                appendTo: "body",
                resizable: false,
                modal: true,
                draggable: false,
                width: window_width+20,
                position: {
//                    top: window_height/2-50,
                    left: -10
                },
                content: {
                    template: detail_window_template
                }

            });

//            e.preventDefault();
        } else {
            alert("请保证信息填写完整！");
            e.preventDefault();


        }


    });

    function submitAllClick(){
        try{
            var signIssuemultiselect = $("#signIssue_Person").data("kendoMultiSelect");//签发
            var signIssuemultiselectvalue = signIssuemultiselect.value()[0];
            var counterSignmultiselect = $("#counterSign_Person").data("kendoMultiSelect");//会签
            var counterSignmultiselectvalue = counterSignmultiselect.value();
            var counterSignmultiselectvalues="";
            for(var i=0;i<counterSignmultiselectvalue.length;i++){
                counterSignmultiselectvalues+=counterSignmultiselectvalue[i]+"|";
            }


            var mainSendmultiselect = $("#mainSend_Person").data("kendoMultiSelect");//主送
            var mainSendmultiselectvalue = mainSendmultiselect.value();
            var mainSendmultiselectvalues="";
            for(var i=0;i<mainSendmultiselectvalue.length;i++){
//                mainSendmultiselectvalues+=mainSendmultiselectvalue[i].groupName+"|";
                mainSendmultiselectvalues+=mainSendmultiselectvalue[i]+"|";
            }

            var copyTomultiselect = $("#copyTo_Person").data("kendoMultiSelect");//抄送
            var copyTomultiselectvalue = copyTomultiselect.value();
            var copyTomultiselectvalues="";
            for(var i=0;i<copyTomultiselectvalue.length;i++){
//                copyTomultiselectvalues+=copyTomultiselectvalue[i].groupName+"|";
                copyTomultiselectvalues+=copyTomultiselectvalue[i]+"|";
            }

            //郑小罗 2014/12/25 添加主送、抄送外单位信息
            var mainSend=$("#mainSend")[0].value;
            var copyTo=$("#copyTo")[0].value;

            var missiveTypemultiselect = $("#missiveType").data("kendoDropDownList");//公文类型
            var missiveTypeMultiselectvalue = missiveTypemultiselect.value();


            var missiveIDValue= $("#MissiveID")[0].value;//公文号


            var secretLevelValue= $("#secretLevel")[0].value;//密级

            var signIssue_imgValue= $("#signIssue_img")[0].src;//签发图片
            var signIssueBase30imgValue= $("#signIssueBase30img")[0].value;//签发base30图片
            var signIssue_ContentValue= $("#signIssue_Content")[0].value.replace(/\n/g,"<br>");//签发content


            var counterSign_imgValue= $("#counterSign_img")[0].src;//会签图片
            var counterSignBase30imgValue= $("#counterSignBase30img")[0].value;//
            var counterSign_ContentValue= $("#counterSign_Content")[0].value.replace(/\n/g,"<br>");//

            var sponsorUnitValue= $("#sponsorUnit")[0].innerText;//主办单位
//            var drafterValue= $("#drafter")[0].innerText;//拟稿人
            var drafterValue= drafterUserName;

            var phoneNumValue= $("#phoneNum")[0].innerText;//电话

            var composeUsermultiselect = $("#composeUser").data("kendoMultiSelect");//排版
            var composeUserValue = composeUsermultiselect.value()[0];


            var dep_LeaderCheckmultiselect = $("#dep_LeaderCheck").data("kendoMultiSelect");//部门领导
            var dep_LeaderValue = dep_LeaderCheckmultiselect.value()[0];

            var officeCheckmultiselect = $("#officeCheck").data("kendoMultiSelect");//办公室复核
            var officeCheckValue = officeCheckmultiselect.value()[0];

            var printCountNumericTextBox = $("#printCount").data("kendoNumericTextBox");//打印份数
            var printCountNumericTextBoxvalue = printCountNumericTextBox.value();


            var CheckReadermultiselect = $("#CheckReader").data("kendoMultiSelect");//校对
            var checkReaderValue = CheckReadermultiselect.value()[0];

            var Printermultiselect = $("#Printer").data("kendoMultiSelect");//校对
            var PrinterValue = Printermultiselect.value()[0];


            var govPublicValue=0;//政府公开属性
            if($("#initiativePublic")[0].checked){govPublicValue=1}
            else if($("#applyForPublic")[0].checked){govPublicValue=2}
            else if($("#forbiddenPublic")[0].checked){govPublicValue=3}

            var missiveTittleValue= $("#missiveTittle")[0].value.replace(/\n/g,"<br>");//标题
            var appendTittleValue= $("#appendTittle")[0].value.replace(/\n/g,"<br>");//附件标题


            var attachmentNames="";
            for(var i=0;i<resultFiles.length;i++){
                attachmentNames=attachmentNames+resultFiles[i].name+"|";
            }
            var attachmentPaths=attachmentNames;


//            var variablesString="";
//            for(var j=0;j<variables.length;j++){
//                if(j==0){
//                    variablesString+=(variables[j].name+","+variables[j].value+","+variables[j].type+","+variables[j].multi);
//                }
//                else{
//                    variablesString+=("|"+variables[j].name+","+variables[j].value+","+variables[j].type+","+variables[j].multi);
//                }
//
//            }

            $("#UserNameF").val(currentUsername);
            $("#instanceIDF").val(instanceID);
            $("#taskIDF").val(taskID);
            $("#missiveNumF").val(missiveIDValue);
            $("#secretLevelF").val(secretLevelValue);
            $("#typeNameF").val(missiveTypeMultiselectvalue);
            $("#docFilePathF").val("NONE");
            $("#pdfFilePathF").val("NONE");
            $("#missiveTittleF").val(missiveTittleValue);
            $("#nameF").val("NOT SET");

            $("#signIssueUserNameF").val(signIssuemultiselectvalue);
            $("#signIssueBase30urlF").val(signIssueBase30imgValue);
            $("#signIssueImageurlF").val(signIssue_imgValue);
            $("#signIssue_ContentF").val(signIssue_ContentValue);

            $("#counterSignUsersNameF").val(counterSignmultiselectvalues);
            $("#counterSignBase30urlF").val(counterSignBase30imgValue);
            $("#counterSignImageurlF").val(counterSign_imgValue);
            $("#counterSign_ContentF").val(counterSign_ContentValue);

            $("#mainSendGroupsF").val(mainSendmultiselectvalues);
            $("#copytoGroupsF").val(copyTomultiselectvalues);

            $("#sponsorUnitF").val(sponsorUnitValue);
            $("#drafterF").val(drafterValue);
            $("#phoneNumF").val(phoneNumValue);
            $("#composeUserF").val(composeUserValue);
            $("#dep_LeaderCheckF").val(dep_LeaderValue);
            $("#officeCheckF").val(officeCheckValue);
            $("#printCountF").val(printCountNumericTextBoxvalue);
            $("#CheckReaderF").val(checkReaderValue);
            $("#PrinterF").val(PrinterValue);
            $("#Gov_info_attrF").val(govPublicValue);
            $("#appendTittleF").val(appendTittleValue);
            $("#appendNameF").val(attachmentNames);
            $("#appendPathF").val(attachmentPaths);
//            $("#activitiVariablesF").val(variablesString);

            //郑小罗 2014/12/25 添加主送、抄送外单位信息
            $("#mainSendF").val(mainSend);
            $("#copyToF").val(copyTo);
        }
        catch (e){
            console.log(e)
        }
        console.log(2);
    }


</script>



<style>
    #missiveForm div label,#missiveForm div textarea{
        font-size: 18px;
        color: #666;
        font-family: "SimSun";
    }
    #validatorDIV div div label,#validatorDIV div div label + div{
        /*margin-top: 2px;*/
        display: inline-block;


    }
    #validatorDIV div div{
        margin-top: 5px;
        margin-bottom: 5px;
    }
    #validatorDIV div div div{
        margin-top: 0px;
        margin-bottom: 0px;
    }

    .vali_lable{ /*表单内的lable样式*/
        width: 100px;
        text-align: right;
        padding-top: 5px;
        padding-right: 5px;
    }
    .vali_input{
        width: 330px;
        border-radius: 4px;
        border-width: 1px;
        box-shadow: none;
        height: 30px;
    }
    .vali_dropdown{
        width: 330px;
    }
    .vali_select{
        width: 330px;
        display: inline-flex;
        margin-left: 2px;
    }
    .vali_textarea{
        border-radius: 4px!important;
        border-width: 1px;
        box-shadow: none;
    }


    #GOVatrrDIV div{
        margin-top: 5px;
        margin-bottom: 5px;
        /*color: #507f50;*/
    }

    span[class="k-numeric-wrap k-state-default"]{
        line-height: 30px;
    }
    #MissiveID{
        width: 330px;border-radius: 4px;line-height: 2;border: 1px solid #d5d5d5;color: #858585;
    }

</style>
<!-- inline scripts related to this page -->
</body>
</html>
